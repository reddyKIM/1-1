---
import BaseLayout from '@layouts/BaseLayout.astro';
import mediaData from '../../../data/media.json';
export function getStaticPaths() {
  return mediaData.map((article) => ({ params: { slug: article.slug }, props: { article } }));
}

const { article } = Astro.props;
const formattedDate = new Date(article.date).toLocaleDateString('ko-KR', {
  year: 'numeric',
  month: 'long',
  day: 'numeric'
});

function parseMarkdown(text) {
  const lines = text.split(/\r?\n/);
  const nodes = [];
  let listItems = [];

  const flushList = () => {
    if (listItems.length > 0) {
      nodes.push({ type: 'list', items: listItems });
      listItems = [];
    }
  };

  for (const line of lines) {
    if (line.startsWith('## ')) {
      flushList();
      nodes.push({ type: 'heading', text: line.slice(3).trim() });
      continue;
    }

    if (line.startsWith('- ')) {
      listItems.push(line.slice(2).trim());
      continue;
    }

    if (line.trim() === '') {
      flushList();
      continue;
    }

    flushList();
    nodes.push({ type: 'paragraph', text: line.trim() });
  }

  flushList();

  return nodes;
}

const contentNodes = parseMarkdown(article.content);
---
<BaseLayout title={`${article.title} | SK에너지`} description={article.excerpt} pageType="article">
  <article class="max-w-none">
    <header class="mb-10 space-y-3">
      <p class="text-sm uppercase tracking-widest text-primary/70">{formattedDate}</p>
      <h1 class="text-4xl font-semibold text-primary">{article.title}</h1>
      <ul class="flex flex-wrap gap-2" aria-label="태그">
        {article.tags?.map((tag) => (
          <li class="rounded-full bg-primary/10 px-3 py-1 text-xs font-semibold text-primary">#{tag}</li>
        ))}
      </ul>
    </header>
    <div class="prose prose-slate max-w-none space-y-4 dark:prose-invert">
      {contentNodes.map((node, index) => {
        if (node.type === 'heading') {
          return <h2>{node.text}</h2>;
        }

        if (node.type === 'list') {
          return (
            <ul>
              {node.items.map((item) => (
                <li>{item}</li>
              ))}
            </ul>
          );
        }

        return <p>{node.text}</p>;
      })}
    </div>
    <a class="mt-10 inline-flex items-center gap-2 text-sm font-semibold text-primary" href="/media">
      ← 목록으로 돌아가기
    </a>
  </article>
</BaseLayout>
